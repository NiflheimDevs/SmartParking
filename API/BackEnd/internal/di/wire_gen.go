// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package di

import (
	redis2 "github.com/go-redis/redis/v8"
	"github.com/niflheimdevs/smartparking/internal/config"
	"github.com/niflheimdevs/smartparking/internal/db"
	"github.com/niflheimdevs/smartparking/internal/delivery/http"
	http_handler "github.com/niflheimdevs/smartparking/internal/delivery/http/handler"
	"github.com/niflheimdevs/smartparking/internal/delivery/mqtt"
	mqtt_handler "github.com/niflheimdevs/smartparking/internal/delivery/mqtt/handler"
	"github.com/niflheimdevs/smartparking/internal/middleware"
	repository "github.com/niflheimdevs/smartparking/internal/repository/postgres"
	"github.com/niflheimdevs/smartparking/internal/repository/redis"
	"github.com/niflheimdevs/smartparking/internal/usecase"
	"gorm.io/gorm"
)

// Injectors from wire.go:

func InitializeApp() (*App, error) {
	configConfig := config.Load()
	gormDB := db.PGConnect(configConfig)
	vehicleRepository := repository.NewVehicleRepository(gormDB)
	vehicleUseCase := usecase.NewVehicleUseCase(vehicleRepository)
	vehicleHandler := http_handler.NewVehicleHandler(vehicleUseCase)
	entranceExitRepository := repository.NewEntranceExitRepository(gormDB)
	entranceExitUseCase := usecase.NewEntranceExitUseCase(configConfig, entranceExitRepository, vehicleUseCase)
	entranceExitHandler := http_handler.NewEntranceExitHandler(entranceExitUseCase)
	parkingSpotRepository := repository.NewParkingSpotRepository(gormDB)
	parkingSpotUseCase := usecase.NewParkingSpotUseCase(entranceExitUseCase, parkingSpotRepository)
	parkingSpotHandler := http_handler.NewParkingSpotHandler(parkingSpotUseCase)
	userRepository := repository.NewUserRepository(gormDB)
	jwt := usecase.NewJWT(configConfig)
	userUseCase := usecase.NewUserUseCase(userRepository, jwt)
	userHandler := http_handler.NewUserHandler(userUseCase)
	client := mqtt.InitMQTTClient(configConfig)
	sensorHandler := mqtt_handler.NewSensorHandler(client, entranceExitUseCase, parkingSpotUseCase, vehicleUseCase)
	gateHandler := http_handler.NewGateHandler(sensorHandler)
	handlers := &http.Handlers{
		Vehicle:      vehicleHandler,
		EntranceExit: entranceExitHandler,
		ParkingSpot:  parkingSpotHandler,
		User:         userHandler,
		Gate:         gateHandler,
	}
	jwtMiddleware := middleware.NewJWTMiddleware(jwt)
	banRepository := repository.NewBanRepository(gormDB)
	banUseCase := usecase.NewBanUseCase(banRepository)
	ipBanMiddleware := middleware.NewIPBanMiddleware(banUseCase)
	redisClient := db.RConnect(configConfig)
	loggerRepository := redis.NewLoggerRepository(redisClient)
	ipLoggerUseCase := usecase.NewIPLoggerUseCase(loggerRepository, banUseCase)
	ipLoggerMiddleware := middleware.NewIPLoggerMiddleware(ipLoggerUseCase)
	middlewares := &http.Middlewares{
		JWT:      jwtMiddleware,
		Ban:      ipBanMiddleware,
		IPLogger: ipLoggerMiddleware,
	}
	httpApp := http.NewHttpApp(configConfig, handlers, middlewares)
	mqttClient := mqtt.InitMQTT(client, sensorHandler)
	app := &App{
		HttpApp:    httpApp,
		MQTTClient: mqttClient,
		Config:     configConfig,
		PGDB:       gormDB,
		RDB:        redisClient,
	}
	return app, nil
}

// wire.go:

type App struct {
	HttpApp    *http.HTTPApp
	MQTTClient *mqtt.MQTTClient
	Config     *config.Config
	PGDB       *gorm.DB
	RDB        *redis2.Client
}
